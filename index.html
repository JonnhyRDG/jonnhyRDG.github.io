<p>### THIS CODE HAS TO BE EXECUTED FROM A PYTHON SCRIPT NODE IN SOLARIS</p>
<p>from pxr import Usd, UsdGeom, Gf<br />import hou<br />import json</p>
<p>node = hou.pwd()</p>
<p><br />class blockbuild():<br /> def __init__(self):<br /> self.dictread()<br /> <br /> def dictread(self):<br /> self.citydict = open("P:/AndreJukebox/assets/sets/city/publish/xml/block_builder.json")<br /> self.cityread = json.load(self.citydict)<br /> <br /> def blockslist(self):<br /> for keys in self.cityread:<br /> blockhierarchy = keys.rsplit("_",1)[0]<br /> block_stage = f'P:/AndreJukebox/assets/sets/{blockhierarchy}/publish/usd/{blockhierarchy}.usd'<br /> self.stage = Usd.Stage.CreateNew(block_stage)<br /> group_prim_path = f'/{keys}'<br /> group_prim = self.stage.DefinePrim(group_prim_path,'Xform')<br /> self.createRefs(blocks=keys,refsnum=len(self.cityread[keys]['assets']))<br /> group_model = Usd.ModelAPI(group_prim)<br /> group_model.SetKind("group")<br /> self.stage.GetRootLayer().Save()<br /> # print('________DONE_________')<br /> <br /> def createRefs(self, blocks, refsnum): <br /> iteration = 0<br /> for buildings in self.cityread[blocks]['assets']:<br /> xform = (self.cityread[blocks]['assets'][buildings]['xform'])<br /> assetname = buildings.rsplit("_",1)[0]<br /> new_building = f"/{blocks}/{buildings}"<br /> <br /> print(new_building)</p>
<p>new_prim = self.stage.DefinePrim(new_building)<br /> assetabc = (self.cityread[blocks]['assets'][buildings]['abcpath'])<br /> new_prim.GetReferences().AddReference(assetabc)<br /> new_prim.SetInstanceable(True)<br /> building_model = Usd.ModelAPI(new_prim)<br /> building_model.SetKind("component")<br /> <br /> # assign the matrix to each building<br /> target_path = self.stage.GetPrimAtPath(new_building)<br /> xformable = UsdGeom.Xformable(target_path)<br /> transform_matrix = eval(xform)<br /> final_matrix = Gf.Matrix4d(transform_matrix)<br /> xformable.ClearXformOpOrder()<br /> xformable.AddTransformOp().Set(value=final_matrix)</p>
<p><br />blockbuild().blockslist()</p>
<p>&nbsp;</p>